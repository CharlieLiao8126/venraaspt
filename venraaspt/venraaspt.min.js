var venstrob={v:"1.6.2",strserver:"apid.pcloud.tw",struuidapi:"/venapis/vengu",strlogapi:"/venapis/log",stract:"action",strcrt:"create",stradd:"add",strrec:"add_rec",stradi:"add_item",strsnd:"send",strall:"all",strwarn:"[warning] venraas ",strnull:"ven_null",strdn:"x",strtoken:"x",strtypeInit:"0",strtypeTracking:"1",strtypeEctrans:"2",strtypeGuid:"3",strtypeSession:"4",strtypeRecomd:"5",venfloctl_processing:"",strDhermesHost:"apih.pcloud.tw",strDHermesApi:"/hermes/api/goods/rank",strCupidHost:"apir.pcloud.tw",
strCupidKeywordApi:"/cupid/api/goods/keywords"},venfloctl={},venraastool={getcookie:function(a){theCookie=document.cookie+";";a+="=";start=theCookie.indexOf(a);return-1!=start?(end=theCookie.indexOf(";",start),theCookie.substring(start+a.length,end)):""},doCookieSetup:function(a,b,c){try{if(0==c)document.cookie=a+"="+escape(b)+";Path=/;domain="+window.location.host.split(".").slice(-3).join(".");else{var d=new Date;d.setTime(d.getTime()+c);document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()+
";Path=/;domain="+window.location.host.split(".").slice(-3).join(".")}}catch(e){}},dect_type:function(a,b){if("string"!=typeof a||"object"!=typeof b)return!1},object_size:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},urlparamfactory:function(a,b){var c=[];if("object"!=typeof b)return"";if(a==venstrob.strnull)for(var d in b)c.push(encodeURIComponent(d)+"="+encodeURIComponent(JSON.stringify(b[d])));else c.push(encodeURIComponent(a)+"="+encodeURIComponent(JSON.stringify(b[a])));
return c.join("&")},xhr:!window.XMLHttpRequest||"file:"===window.location.protocol&&window.ActiveXObject?function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}:function(){return new window.XMLHttpRequest},getvenuuid:function(a,b){try{var c="?id="+top.location.host+"&typ="+a+"&pt=a";if(window.XDomainRequest&&(0<navigator.userAgent.indexOf("MSIE 8.0")||0<navigator.userAgent.indexOf("MSIE 9.0")))venstrob.venfloctl_processing=b,venraastool.ven_jsonp("https://"+venstrob.strserver+
venstrob.struuidapi+c+"&cbk=y");else if(0<navigator.userAgent.indexOf("MSIE 7.0")||0<navigator.userAgent.indexOf("MSIE 6.0"))venstrob.venfloctl_processing=b,venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.struuidapi+c+"&cbk=y");else{var d=venraastool.xhr();d.open("GET","https://"+venstrob.strserver+venstrob.struuidapi+c,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");d.withCredentials=!0;d.onreadystatechange=function(){try{4==d.readyState&&200==
d.status&&(vencontrob.vencookiecontr(a,d.responseText),"s"==a?vencontrob.actioncontroller(b):venfloctl[b].status=!0)}catch(e){}};d.send()}}catch(e){}},isarray:function(a){return!!a&&"object"===typeof a&&"number"===typeof a.length&&"function"===typeof a.splice&&!a.propertyIsEnumerable("length")},ven_jsonp:function(a){try{var b=document.createElement("script");b.setAttribute("src",a);document.body.appendChild(b)}catch(c){}},hashCode:function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++){var d=
a.charCodeAt(c);b=(b<<5)-b+d;b|=0}return b},updateCachekeys:function(a,b){var c="venraas-token"+a+" cache keys",d=(new Date).getTime(),e={key:b,expires_timestamp:d+6048E5},g=localStorage.getItem(c),f=[e];if(g){f=JSON.parse(g);var h=!1;f.forEach(function(a,c,d){a.key===b&&(d[c]=e,h=!0)});h||f.push(e);f.forEach(function(a,b,c){a.expires_timestamp<=d&&localStorage.removeItem(a.key)});f=f.filter(function(a){return d<a.expires_timestamp})}localStorage.setItem(c,JSON.stringify(f))},getrecomd:function(a){var b=
venfloctl[a].objv.param;b.ven_guid=venraastool.getcookie("venguid");b.ven_session=venraastool.getcookie("vensession");var c=venfloctl[a].objv.callback,d=JSON.stringify({device:b.device,rec_pos:b.rec_pos,rec_type:b.rec_type,token:b.token}),e=venraastool.xhr();e.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){c(this.responseText,b);var e=JSON.parse(this.responseText);e.recomd_list&&0<e.recomd_list.length&&(localStorage.setItem(d,this.responseText),venraastool.updateCachekeys(b.token,
d));venfloctl[a].status=!0}}catch(h){console.log(h.message)}};e.timeout=2E3;e.ontimeout=function(a){(a=localStorage.getItem(d))?console.log("venraas recomd timeout! response the last result"):(a={},console.log("venraas recomd timeout! none of the last result"));c(a,b)};e.open("POST","https://"+venstrob.strDhermesHost+venstrob.strDHermesApi,!0);e.setRequestHeader("Content-type","application/json; charset=UTF-8");e.withCredentials=!0;var g=JSON.stringify(b);e.send(g)},recomd:function(a,b){if(""==venraastool.getcookie("venguid")&&
"undefined"!==typeof venfloctl){var c=venraastool.object_size(venfloctl);venfloctl[c]={};venfloctl[c].status=!1;venfloctl[c].contr="";venfloctl[c].venact="";venfloctl[c].objv="";venfloctl[c].type=venstrob.strtypeGuid;venfloctl[c].retry=0;venraas.ven_cps(c)}""==venraastool.getcookie("vensession")&&"undefined"!==typeof venfloctl&&(c=venraastool.object_size(venfloctl),venfloctl[c]={},venfloctl[c].status=!1,venfloctl[c].contr="",venfloctl[c].venact="",venfloctl[c].objv="",venfloctl[c].type=venstrob.strtypeSession,
venfloctl[c].retry=0,venraas.ven_cps(c));"undefined"!==typeof venfloctl&&(c=venraastool.object_size(venfloctl),venfloctl[c]={},venfloctl[c].status=!1,venfloctl[c].contr="",venfloctl[c].venact="",venfloctl[c].objv={param:a,callback:b},venfloctl[c].type=venstrob.strtypeRecomd,venfloctl[c].retry=0,venraas.ven_cps(c))},goods_keywords:function(a,b){var c=venraastool.xhr();c.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&b(this.responseText)}catch(e){console.log(e.message)}};c.open("POST",
"https://"+venstrob.strCupidHost+venstrob.strCupidKeywordApi,!0);c.setRequestHeader("Content-type","application/json; charset=UTF-8");c.withCredentials=!0;var d=JSON.stringify(a);c.send(d)}},vencontrob={createcontr:function(a,b){this.creadata(a);this.setpdata(a,venstrob.stract,a);this.addcontr(a,b)},addcontr:function(a,b){for(var c in b)this.setpdata(a,c,b[c])},addrecitemcontr:function(a,b){venraastool.isarray(this.pdata[a].now_rec)||(this.pdata[a].now_rec=[]);this.pdata[a].now_rec[this.pdata[a].now_rec.length]=
b},addtritemcontr:function(a,b){venraastool.isarray(this.pdata[a].trans_i.ilist)||(this.pdata[a].trans_i.ilist=[]);this.pdata[a].trans_i.ilist[this.pdata[a].trans_i.ilist.length]=b},sendcontr:function(a){a==venstrob.strall?this.apirequest(venstrob.strnull):this.apirequest(a)},autoretrieve:function(a){this.setpdata(a,"para",location.search);this.setpdata(a,"uri",location.pathname);this.setpdata(a,"client_host",venstrob.strdn);this.setpdata(a,"token",venstrob.strtoken);this.setpdata(a,"tophost",top.location.host);
this.setpdata(a,"referrer",document.referrer);try{this.setpdata(a,"client_tzo",(new Date).getTimezoneOffset()),this.setpdata(a,"client_utc",(new Date).getTime())}catch(c){}this.setpdata(a,"ven_guid",venraastool.getcookie("venguid"));this.setpdata(a,"ven_session",venraastool.getcookie("vensession"));this.setpdata(a,"ver",venstrob.v);var b=this.getpdata(a,"from_rec");b&&"null"!=b||(b=(new URL(location.href)).searchParams.get("from_rec"))&&this.setpdata(a,"from_rec",b)},pdata:{},creadata:function(a){this.pdata[a]=
{}},getpdata:function(a,b){return this.pdata[a]?this.pdata[a][b]:void 0},setpdata:function(a,b,c){"undefined"==typeof this.pdata[a]&&(this.pdata[a]={});this.pdata[a][b]=c},delpdata:function(a){a==venstrob.strnull?this.pdata={}:this.pdata[a]={}},apirequest:function(a){a=venraastool.urlparamfactory(a,this.pdata);if(""!==a)try{if(window.XDomainRequest&&(0<navigator.userAgent.indexOf("MSIE 8.0")||0<navigator.userAgent.indexOf("MSIE 9.0")))venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.strlogapi+
"?"+a);else if(0<navigator.userAgent.indexOf("MSIE 7.0")||0<navigator.userAgent.indexOf("MSIE 6.0"))venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.strlogapi+"?"+a);else{var b=venraastool.xhr();b.open("POST","https://"+venstrob.strserver+venstrob.strlogapi,!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");b.withCredentials=!0;b.onreadystatechange=function(){};b.send(a)}}catch(c){}},actioncontroller:function(a){var b=venfloctl[a].venact,c=venfloctl[a].objv;
switch(venfloctl[a].contr){case venstrob.strcrt:var d=!0;0==c.autosend&&(d=!1);vencontrob.createcontr(b,c);vencontrob.autoretrieve(b);1==d&&vencontrob.sendcontr(b);break;case venstrob.stradd:vencontrob.addcontr(b,c);break;case venstrob.strsnd:vencontrob.sendcontr(b);break;case venstrob.strrec:vencontrob.addrecitemcontr(b,c)}venfloctl[a].status=!0},vencookiecontr:function(a,b){"g"==a?venraastool.doCookieSetup("venguid",b,31536E7):"s"==a&&venraastool.doCookieSetup("vensession",b,18E5)}};
function vengujsonpcallbk(a,b){try{vencontrob.vencookiecontr(a,b),"s"==a?vencontrob.actioncontroller(venstrob.venfloctl_processing):venfloctl[venstrob.venfloctl_processing].status=!0}catch(c){}}
var venraas={init:function(a){try{"undefined"!==typeof a&&"undefined"!==typeof a.domainName&&(venstrob.strdn=a.domainName);"undefined"!==typeof a&&"undefined"!==typeof a.token&&(venstrob.strtoken=a.token);if(null===document.getElementById("venraasfr")){var b=document.createElement("iframe");b.setAttribute("id","venraasfr");b.style.display="none";b.style.width="1px";b.style.height="1px";b.style.border="0px";b.style.padding="0px";b.style.margin="0px";b.src="https://"+venstrob.strserver+venstrob.struuidapi;
"undefined"==typeof a||"undefined"==typeof a.tagID?document.body.appendChild(b):null!==document.getElementById(a.tagID)?document.getElementById(a.tagID).appendChild(b):console.log("[Error] venraas document.getElementById("+a.tagID+") is not exist!")}if(""==venraastool.getcookie("venguid")&&"undefined"!==typeof venfloctl){var c=venraastool.object_size(venfloctl);venfloctl[c]={};venfloctl[c].status=!1;venfloctl[c].contr="";venfloctl[c].venact="";venfloctl[c].objv="";venfloctl[c].type=venstrob.strtypeGuid;
venfloctl[c].retry=0;this.ven_cps(c)}}catch(d){}},tracking:function(a,b){try{if("undefined"==typeof b&&(b={}),0!=venraastool.dect_type(a,b)){var c="",d="";-1<a.indexOf("|")?(cmdar=a.split("|"),c=cmdar[0],d=cmdar[1]):(c=venstrob.strall,d=a);if("undefined"!==typeof venfloctl){var e=venraastool.object_size(venfloctl);venfloctl[e]={};venfloctl[e].status=!1;venfloctl[e].contr=d;venfloctl[e].venact=c;venfloctl[e].objv=b;venfloctl[e].type=venstrob.strtypeTracking;venfloctl[e].retry=0;this.ven_cps(e)}}}catch(g){}},
ven_tracking:function(a){""==venraastool.getcookie("vensession")?venraastool.getvenuuid("s",a):(venraastool.doCookieSetup("vensession",venraastool.getcookie("vensession"),18E5),vencontrob.actioncontroller(a))},ven_cps:function(a){try{if(0==a||venfloctl[a-1].status)switch(venfloctl[a].type){case venstrob.strtypeTracking:venraas.ven_tracking(a);break;case venstrob.strtypeEctrans:venraas.ven_ecTransaction(a);break;case venstrob.strtypeGuid:venraastool.getvenuuid("g",a);break;case venstrob.strtypeSession:venraastool.getvenuuid("s",
a);break;case venstrob.strtypeRecomd:venraastool.getrecomd(a)}else 3>venfloctl[a].retry&&(venfloctl[a].retry++,setTimeout("venraas.ven_cps("+a+")",100))}catch(b){}},ecTransaction:function(a,b){try{if("undefined"==typeof b&&(b={}),0!=venraastool.dect_type(a,b)){var c="",d="";-1<a.indexOf("|")&&(cmdar=a.split("|"),c=cmdar[0],d=cmdar[1]);if("undefined"!==typeof venfloctl){var e=venraastool.object_size(venfloctl);venfloctl[e]={};venfloctl[e].status=!1;venfloctl[e].contr=d;venfloctl[e].venact=c;venfloctl[e].objv=
b;venfloctl[e].type=venstrob.strtypeEctrans;venfloctl[e].retry=0;this.ven_cps(e)}}}catch(g){}},ven_ecTransaction:function(a){var b=venfloctl[a].objv,c=venfloctl[a].venact;switch(venfloctl[a].contr){case venstrob.stradd:b.ilist={};var d={};d.trans_i=b;vencontrob.addcontr(c,d);break;case venstrob.stradi:vencontrob.addtritemcontr(c,b);break;default:console.log(venstrob.strwarn+":input exception. c3")}venfloctl[a].status=!0}};
